---
- name: Create LiteLLM Virtual Key (Single User Example)
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create virtual key
      ansible.builtin.include_role:
        name: litemaas.virtual_keys.manage_keys
      vars:
        litellm_vkey_state: present
        litellm_vkey_api_url: "https://litellm.example.com"
        litellm_vkey_master_key: "{{ lookup('env', 'LITELLM_MASTER_KEY') }}"
        litellm_vkey_alias: "my-dev-project"
        litellm_vkey_user_id: "developer@example.com"
        litellm_vkey_models:
          - "openai/granite-3-2-8b-instruct"
          - "openai/mistral-7b-instruct"
        litellm_vkey_duration: "7d"

    - name: Display the key
      ansible.builtin.debug:
        msg: |
          API Key Created!

          Export this to use with LiteLLM:
          export OPENAI_API_BASE="{{ litellm_vkey_result.api_base_url }}"
          export OPENAI_API_KEY="{{ litellm_vkey_result.key }}"

          Available models: {{ litellm_vkey_result.models | join(', ') }}
          Valid for: {{ litellm_vkey_result.duration }}
