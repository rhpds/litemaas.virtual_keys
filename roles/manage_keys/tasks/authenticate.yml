---
# =============================================================================
# LiteMaaS Virtual Keys - Authentication Handler
# =============================================================================
# Validates master key and sets authorization header for API calls
# =============================================================================

- name: Validate master key is provided
  ansible.builtin.assert:
    that:
      - litellm_vkey_master_key is defined
      - litellm_vkey_master_key | length > 0
    fail_msg: |
      LiteLLM master key is required.

      Please provide the master key:
        litellm_vkey_master_key: "sk-xxxxx"

      Or set environment variable:
        export LITELLM_MASTER_KEY="sk-xxxxx"

      Then reference it in your playbook:
        litellm_vkey_master_key: "{{ lookup('env', 'LITELLM_MASTER_KEY') }}"
    quiet: true

- name: Set authentication header
  ansible.builtin.set_fact:
    _litellm_auth_header: "Bearer {{ litellm_vkey_master_key }}"
    _litellm_auth_method: "master_key"

- name: Display authentication method
  ansible.builtin.debug:
    msg: "Using master key authentication"
